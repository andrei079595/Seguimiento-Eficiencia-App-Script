/**
 * Extrae nombres compuestos y el primer apellido.
 * @param {string} nombreCompleto Texto con el nombre completo.
 * @customfunction
 */
function NOMBRE_Y_APELLIDO(nombreCompleto) {
  if (!nombreCompleto) return "";
  
  const palabras = nombreCompleto.toString().trim().split(/\s+/);
  const conectores = ["DE", "DEL", "LA", "LAS", "LOS"];
  
  // Lista de nombres que suelen ser el primer o segundo componente de un nombre compuesto
  const nombresCompuestos = ["MARIA", "PAULA", "JUAN", "JOSE", "ANA", "LUIS", "CARLOS", "ANDREA", "ALEJANDRA"];
  
  if (palabras.length <= 2) return nombreCompleto;

  let resultado = [];
  resultado.push(palabras[0]); // Siempre incluimos la primera palabra

  let i = 1;

  // 1. Verificar si la segunda palabra es parte del nombre (Nombre compuesto)
  if (nombresCompuestos.includes(palabras[0].toUpperCase()) || nombresCompuestos.includes(palabras[1].toUpperCase())) {
    resultado.push(palabras[1]);
    i = 2;
  }

  // 2. Manejar conectores de apellido (Ej: "De La Espriella" o "De Greiff")
  while (i < palabras.length) {
    if (conectores.includes(palabras[i].toUpperCase()) && i < palabras.length - 1) {
      resultado.push(palabras[i]);
      i++;
    } else {
      resultado.push(palabras[i]); // Agregar el cuerpo del apellido
      break; 
    }
  }

  return resultado.join(" ");
}
